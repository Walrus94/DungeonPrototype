{
  "dashboard": {
    "id": null,
    "uid": "java21-vt-metrics",
    "title": "Dungeon Java 21 Virtual Threads & Structured Task Metrics",
    "timezone": "browser",
    "schemaVersion": 37,
    "version": 1,
    "refresh": "10s",
    "panels": [
      {
        "title": "Active Virtual Threads",
        "type": "timeseries",
        "targets": [
          {
            "expr": "jfr_virtual_threads",
            "legendFormat": "Active Virtual Threads"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "threads",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                { "color": "green", "value": null },
                { "color": "red", "value": 1000 }
              ]
            }
          }
        }
      },
      {
        "title": "Virtual Threads Created (Rate)",
        "type": "timeseries",
        "targets": [
          {
            "expr": "rate(jfr_virtual_threads_created[1m])",
            "legendFormat": "New Virtual Threads/sec"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "threads/s",
            "color": { "mode": "palette-classic" }
          }
        }
      },
      {
        "title": "Structured Task Execution Time",
        "type": "gauge",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(jfr_structured_task_execution_time_seconds_bucket[1m]))",
            "legendFormat": "95th Percentile Execution Time"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "s",
            "max": 10,
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                { "color": "green", "value": null },
                { "color": "yellow", "value": 5 },
                { "color": "red", "value": 8 }
              ]
            }
          }
        }
      },
      {
        "title": "CPU Time Spent in Virtual Threads",
        "type": "timeseries",
        "targets": [
          {
            "expr": "rate(jfr_virtual_thread_cpu_time_seconds[1m])",
            "legendFormat": "CPU Time in Virtual Threads"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "s",
            "color": { "mode": "continuous-GrYlRd" }
          }
        }
      },
      {
        "title": "Loki - Virtual Thread Logs",
        "type": "logs",
        "targets": [
          {
            "expr": "{job='java-app-logs'} |= \"VirtualThread\"",
            "datasource": "loki"
          }
        ]
      },
      {
        "title": "Loki - Thread Stack Traces",
        "type": "logs",
        "targets": [
          {
            "expr": "{job='java-app-logs'} |= \"java.lang.Thread.getStackTrace\"",
            "datasource": "loki"
          }
        ]
      },
      {
        "title": "Virtual Thread Blocked Time",
        "type": "timeseries",
        "targets": [
          {
            "expr": "rate(jfr_virtual_thread_blocked_time_seconds[1m])",
            "legendFormat": "Blocked Time in Virtual Threads"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "s",
            "color": { "mode": "continuous-GrYlRd" }
          }
        }
      },
      {
        "title": "Virtual Thread Wait Time",
        "type": "timeseries",
        "targets": [
          {
            "expr": "rate(jfr_virtual_thread_wait_time_seconds[1m])",
            "legendFormat": "Wait Time in Virtual Threads"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "s",
            "color": { "mode": "continuous-GrYlRd" }
          }
        }
      }
    ]
  }
}